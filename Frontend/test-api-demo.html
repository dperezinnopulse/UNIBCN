<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test API Demo - UB Actividad 1</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-4">
        <h1 class="mb-4">🧪 Test API Demo - UB Actividad 1</h1>
        
        <div class="alert alert-info">
            <i class="bi bi-info-circle"></i> 
            <strong>Modo Demo:</strong> Esta página muestra datos de ejemplo mientras se configura el backend.
        </div>
        
        <div class="row">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5>Estado del Backend</h5>
                    </div>
                    <div class="card-body">
                        <div id="backend-status" class="alert alert-warning">
                            <i class="bi bi-exclamation-triangle"></i> Backend en configuración - Usando datos demo
                        </div>
                        <button class="btn btn-primary" onclick="testBackend()">
                            <i class="bi bi-arrow-clockwise"></i> Probar Conexión Real
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5>Endpoints de Prueba (Demo)</h5>
                    </div>
                    <div class="card-body">
                        <div class="d-grid gap-2">
                            <button class="btn btn-outline-success" onclick="testEndpointDemo('/api/estados')">
                                <i class="bi bi-list-check"></i> Estados (Demo)
                            </button>
                            <button class="btn btn-outline-success" onclick="testEndpointDemo('/api/unidades-gestion')">
                                <i class="bi bi-building"></i> Unidades de Gestión (Demo)
                            </button>
                            <button class="btn btn-outline-success" onclick="testEndpointDemo('/api/actividades')">
                                <i class="bi bi-calendar-event"></i> Actividades (Demo)
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="row mt-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5>Respuesta de la API</h5>
                    </div>
                    <div class="card-body">
                        <pre id="api-response" class="bg-light p-3 rounded" style="max-height: 400px; overflow-y: auto;">Haz clic en un botón para ver los datos demo...</pre>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE_URL = 'https://localhost:7001';
        
        // Datos de demo
        const demoData = {
            '/api/estados': [
                { id: 1, nombre: "Borrador" },
                { id: 2, nombre: "En Revisión" },
                { id: 3, nombre: "Aprobado" },
                { id: 4, nombre: "Rechazado" },
                { id: 5, nombre: "Cancelado" }
            ],
            '/api/unidades-gestion': [
                { id: 1, nombre: "IDP - Institut de Desenvolupament Professional" },
                { id: 2, nombre: "CRAI - Centre de Recursos per a l'Aprenentatge i la Investigació" },
                { id: 3, nombre: "SAE - Servei d'Activitats Extraordinàries" }
            ],
            '/api/actividades': {
                items: [
                    {
                        id: 1,
                        titulo: "Jornada de Innovación Docente 2025",
                        descripcion: "Jornada sobre nuevas metodologías de enseñanza",
                        fechaInicio: "2025-03-15",
                        fechaFin: "2025-03-15",
                        estadoId: 3,
                        unidadGestionId: 1,
                        estado: { nombre: "Aprobado" },
                        unidadGestion: { nombre: "IDP" }
                    },
                    {
                        id: 2,
                        titulo: "Curso de Gestión de Bibliotecas Digitales",
                        descripcion: "Formación especializada en gestión de recursos digitales",
                        fechaInicio: "2025-04-10",
                        fechaFin: "2025-04-12",
                        estadoId: 2,
                        unidadGestionId: 2,
                        estado: { nombre: "En Revisión" },
                        unidadGestion: { nombre: "CRAI" }
                    }
                ],
                totalItems: 2,
                page: 1,
                pageSize: 10,
                totalPages: 1
            }
        };
        
        async function testBackend() {
            const statusDiv = document.getElementById('backend-status');
            const responseDiv = document.getElementById('api-response');
            
            statusDiv.className = 'alert alert-info';
            statusDiv.innerHTML = '<i class="bi bi-hourglass-split"></i> Verificando conexión real...';
            
            try {
                const response = await fetch(`${API_BASE_URL}/api/estados`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                if (response.ok) {
                    statusDiv.className = 'alert alert-success';
                    statusDiv.innerHTML = '<i class="bi bi-check-circle"></i> ¡Backend conectado correctamente!';
                    
                    const data = await response.json();
                    responseDiv.textContent = JSON.stringify(data, null, 2);
                } else {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
            } catch (error) {
                statusDiv.className = 'alert alert-warning';
                statusDiv.innerHTML = `<i class="bi bi-exclamation-triangle"></i> Backend no disponible: ${error.message}`;
                responseDiv.textContent = `Error de conexión: ${error.message}\n\nEl backend aún se está configurando. Usa los botones de demo para ver datos de ejemplo.`;
            }
        }
        
        function testEndpointDemo(endpoint) {
            const responseDiv = document.getElementById('api-response');
            const data = demoData[endpoint];
            
            if (data) {
                responseDiv.textContent = JSON.stringify(data, null, 2);
            } else {
                responseDiv.textContent = `Endpoint ${endpoint} no disponible en demo`;
            }
        }
        
        // Mostrar datos de estados al cargar la página
        window.addEventListener('load', function() {
            testEndpointDemo('/api/estados');
        });
    </script>
</body>
</html>
