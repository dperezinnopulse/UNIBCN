
<!DOCTYPE html>

<html lang="es">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>

<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
<meta http-equiv="Pragma" content="no-cache" />
<meta http-equiv="Expires" content="0" />
<title>Propuesta de Actividad - UB</title>
<link rel="icon" type="image/x-icon" href="favicon.ico">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"/>
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet"/>

<link href="css/styles.css" rel="stylesheet"/>
<style>
/* UG Visual cues */
[data-ug~="IDP"]{ border:1px solid #fcd34d; border-left:6px solid #f59e0b; border-radius:10px; padding:12px; background:#fffbeb; }
[data-ug~="CRAI"]{ border:1px solid #93c5fd; border-left:6px solid #3b82f6; border-radius:10px; padding:12px; background:#eff6ff; }
[data-ug~="SAE"]{ border:1px solid #86efac; border-left:6px solid #10b981; border-radius:10px; padding:12px; background:#ecfdf5; }
.usersubmenu .ugOption{ display:flex; align-items:center; gap:8px; }
.usersubmenu .ugOption .chip{ width:12px; height:12px; border-radius:999px; display:inline-block; }
.usersubmenu .ugOption[data-ug="IDP"] .chip{ background:#f59e0b; }
.usersubmenu .ugOption[data-ug="CRAI"] .chip{ background:#3b82f6; }
.usersubmenu .ugOption[data-ug="SAE"] .chip{ background:#10b981; }
.usersubmenu .ugOption[data-ug="Todas"] .chip{ background:#6b7280; }
</style>
</head>
<body>
<script>
  (function(){
    try {
      var token = localStorage.getItem('ub_token');
      if (!token) { window.location.replace('login.html'); }
    } catch (e) {
      window.location.replace('login.html');
    }
  })();
  </script>
<div class="d-flex">
<!-- Contenedor para el men√∫ lateral cargado din√°micamente -->
<div id="sidebarContainer"></div>
<!-- Contenido principal -->
<div class="flex-grow-1">
<!-- Contenedor de la cabecera (se insertar√° din√°micamente) -->
<div id="headerContainer"></div>
<!-- Formulario -->
<main class="p-4"><div class="bg-white rounded shadow p-3 mb-3" id="cabeceraPropuesta">
<div class="d-flex flex-wrap align-items-center justify-content-between gap-2">
<div class="d-flex align-items-center gap-3 flex-wrap">
<span class="badge px-3 py-2" id="estadoBadge" style="background:#6c757d; font-weight:600;">Borrador</span>
<div class="text-muted small"><i class="bi bi-calendar3 me-1"></i><span id="fechaCreacion">‚Äî</span></div>
<div class="text-muted small"><i class="bi bi-clock-history me-1"></i>Actualizado <span id="fechaUpdate">hoy</span></div>
<div class="text-muted small"><i class="bi bi-person me-1"></i><span id="responsablePropuesta">Cargando...</span></div>
</div>
<div class="d-flex align-items-center gap-2">
<a class="btn btn-outline-secondary btn-sm" href="historico.html"><i class="bi bi-arrow-left"></i> Volver</a>
</div>
</div>
</div>
<div class="bg-white rounded shadow p-4 mb-5">
<h2 class="h5 mb-4 text-primary">Informaci√≥n general</h2>
<div class="row g-3">
<div class="col-md-4"><label class="form-label">C√≥digo de la actividad</label><input class="form-control" id="actividadCodigo" type="text"/></div>
<div class="col-md-4 position-relative">
<label class="form-label">T√≠tulo de la actividad</label>
<div class="input-group">
<input class="form-control" id="actividadTitulo" type="text"/>
<span class="input-group-text" onclick="mostrarTraduccion(this)" style="cursor:pointer;">üåê</span>
</div>
<div class="traduccion bg-light p-3 rounded border mt-2 d-none">
<label class="form-label mt-1">Catal√°n</label><input class="form-control mb-1" id="actividadTituloCA" type="text"/>
<label class="form-label">Castellano</label><input class="form-control mb-1" id="actividadTituloES" type="text"/>
<label class="form-label">Ingl√©s</label><input class="form-control" id="actividadTituloEN" type="text"/>
</div>
</div>
<div class="col-md-4"><label class="form-label">Tipo de actividad</label><select class="form-select" id="tipoActividad"><option>Jornada</option></select></div>
<div class="col-md-4"><label class="form-label">Unidad gestora</label><select class="form-select" id="actividadUnidadGestion"><option>IDP</option><option>CRAI</option><option>SAE</option></select></div>
<div class="col-12"><label class="form-label">Descripci√≥n</label><textarea class="form-control" id="descripcion" rows="3" placeholder="Descripci√≥n de la actividad"></textarea></div>
<div class="col-md-4"><label class="form-label">Condiciones econ√≥micas</label><input class="form-control" id="condicionesEconomicas" type="text"/></div>
<div class="col-md-4"><label class="form-label">A√±o acad√©mico</label><input class="form-control" id="actividadAnioAcademico" placeholder="2025-2026" type="text"/></div>
<div class="col-md-4"><label class="form-label">L√≠nea estrat√©gica</label><select class="form-select" id="lineaEstrategica"><option>L√≠nea 1</option></select></div>
<div class="col-md-4"><label class="form-label">Objetivo estrat√©gico</label><select class="form-select" id="objetivoEstrategico"><option>L√≠nea 1</option></select></div>
<div class="col-md-4"><label class="form-label">C√≥digo relacionado</label><input class="form-control" id="codigoRelacionado" type="text"/></div>
<div class="col-md-4"><label class="form-label">Actividad reservada</label><select class="form-select" id="actividadReservada"><option>PDI</option></select></div>
<div class="col-md-4"><label class="form-label">Fecha de actividad</label><input class="form-control" id="fechaActividad" type="date"/></div>
<div class="col-md-4"><label class="form-label">Motivo de cierre</label><input class="form-control" id="motivoCierre" type="text"/></div>
<div class="col-md-4"><label class="form-label">Persona solicitante</label><input class="form-control" id="personaSolicitante" type="text"/></div>
<div class="col-md-4"><label class="form-label">Coordinador/a</label><input class="form-control" id="coordinador" type="text"/></div>
<div class="col-md-4"><label class="form-label">Jefe/a unidad gestora</label><input class="form-control" id="jefeUnidadGestora" type="text"/></div>
<div class="col-md-4"><label class="form-label">Gestor/a de la actividad</label><input class="form-control" id="gestorActividad" type="text"/></div>
<div class="col-md-4"><label class="form-label">Facultad destinataria</label><input class="form-control" id="facultadDestinataria" type="text"/></div>
<div class="col-md-4"><label class="form-label">Departamento destinatario</label><input class="form-control" id="departamentoDestinatario" type="text"/></div>
<div class="col-md-4"><label class="form-label">Centro/unidad UB destinataria</label><select class="form-select" id="centroUnidadUBDestinataria"><option>Seleccionar</option></select></div>
<div class="col-md-4"><label class="form-label">Otros centros/instituciones</label><input class="form-control" id="otrosCentrosInstituciones" type="text"/></div>
<div class="col-md-4"><label class="form-label">Plazas totales</label><input class="form-control" id="plazasTotales" type="number" min="0" step="1" inputmode="numeric"/></div>
<div class="col-md-4"><label class="form-label">Horas totales</label><input class="form-control" id="horasTotales" type="number" min="0" step="0.5" inputmode="decimal"/></div>
<div class="col-md-4"><label class="form-label">Centro de trabajo requerido en la matr√≠cula</label><select class="form-select" id="centroTrabajoRequerido"><option>S√≠</option><option>No</option></select></div>
<div class="col-md-4"><label class="form-label">Modalidad de gesti√≥n</label><select class="form-select" id="modalidadGestion"><option>Acreditada UB</option></select></div>
<div class="col-md-4"><label class="form-label">F. inicio de la imp.</label><input class="form-control" id="fechaInicioImparticion" type="date"/></div>
<div class="col-md-4"><label class="form-label">F. final de la imp.</label><input class="form-control" id="fechaFinImparticion" type="date"/></div>
<div class="col-md-3">
<label class="form-label d-block">Actividad de pago</label>
<div class="form-check form-switch">
<input class="form-check-input" data-save="1" id="actividadPago" onchange="toggleImporte()" type="checkbox"/>
<label class="form-check-label" for="actividadPago">S√≠</label>
</div>
</div></div>
<div class="row g-3 mt-1">
<div class="col-md-6" data-ug="IDP">
<label class="form-label">Coordinador/a de centre/unitat (IDP)</label>
<input class="form-control" id="coordinadorCentreUnitat" placeholder="Nombre y apellidos"/>
</div>
<div class="col-md-6" data-ug="IDP">
<label class="form-label">Centre de treball de l'alumne (IDP)</label>
<input class="form-control" id="centreTreballeAlumne" placeholder="Centro de trabajo"/>
</div>
</div>
<div class="row g-3 mt-1">
<div class="col-md-4" data-ug="CRAI">
<label class="form-label">Cr√®dits totals (CRAI)</label>
<input class="form-control" id="creditosTotalesCRAI" min="0" placeholder="0" step="0.5" type="number"/>
</div>
</div>
<div class="row g-3 mt-1">
<div class="col-md-4" data-ug="SAE">
<label class="form-label">Cr√®dits totals (SAE)</label>
<input class="form-control" id="creditosTotalesSAE" min="0" placeholder="0" step="0.5" type="number"/>
</div>
<div class="col-md-4" data-ug="SAE">
<label class="form-label">Cr√®dits m√≠nims (SAE)</label>
<input class="form-control" id="creditosMinimosSAE" min="0" placeholder="0" step="0.5" type="number"/>
</div>
<div class="col-md-4" data-ug="SAE">
<label class="form-label">Cr√®dits m√†xims (SAE)</label>
<input class="form-control" id="creditosMaximosSAE" min="0" placeholder="0" step="0.5" type="number"/>
</div>
</div>
</div>
<!-- INFORMACI√ìN GENERAL COMPLETA -->
<!-- PROGRAMA -->
<section class="mb-5" id="seccion-entidades">
<h2 class="h5 mb-3 border-bottom pb-2">Entidades organizadoras</h2>
<div class="row g-3">
<div class="col-md-6"><label class="form-label">Organizadora principal</label><input class="form-control" data-save="1" id="org_principal" placeholder="Nombre de la entidad" type="text"/></div>
<div class="col-md-3"><label class="form-label">NIF/CIF</label><input class="form-control" data-save="1" id="org_nif" type="text" pattern="^([0-9]{8}[A-Za-z]|[XYZxyz][0-9]{7}[A-Za-z]|[ABCDEFGHJNPQRSUVW][0-9]{7}[0-9A-J])$" title="Introduzca NIF, NIE o CIF v√°lido (ej. 12345678Z, X1234567L, B12345678)" maxlength="9"/></div>
<div class="col-md-3"><label class="form-label">Web</label><input class="form-control" data-save="1" id="org_web" placeholder="https://..." type="url"/></div>
<div class="col-md-4"><label class="form-label">Persona de contacto</label><input class="form-control" data-save="1" id="org_contacto" type="text"/></div>
<div class="col-md-4"><label class="form-label">Email</label><input class="form-control" data-save="1" id="org_email" type="email" autocomplete="email"/></div>
<div class="col-md-4"><label class="form-label">Tel√©fono</label><input class="form-control" data-save="1" id="org_tel" type="tel" inputmode="tel" pattern="^[0-9+\s().-]{6,20}$" title="Formato de tel√©fono v√°lido (n√∫meros, +, espacios, guiones)" autocomplete="tel"/></div>
</div>
<div class="mt-4">
<h3 class="h6">Entidades colaboradoras</h3>
<div class="mb-3" id="colaboradorasContainer"></div>
<button class="btn btn-outline-primary" onclick="addColaboradora()" type="button">A√±adir colaboradora</button>
</div>
</section>
<section class="mb-5" id="importeCampos">
<h2 class="h5 mb-3 border-bottom pb-2">Importe y descuentos</h2>
<div class="row g-3">
<div class="col-md-3">
<label class="form-label">Importe base (‚Ç¨)</label>
<input class="form-control" data-save="1" id="imp_base" min="0" step="0.01" type="number" inputmode="decimal"/>
</div>
<div class="col-md-3">
<label class="form-label">Impuesto</label>
<select class="form-select" data-save="1" id="imp_tipo">
<option value="">Selecciona</option>
<option>IVA 21%</option>
<option>IVA 10%</option>
<option>IVA 4%</option>
<option>Exento</option>
</select>
</div>
<div class="col-md-3">
<label class="form-label">Descuento (%)</label>
<input class="form-control" data-save="1" id="imp_descuento_pct" max="100" min="0" step="1" type="number" inputmode="numeric"/>
</div>
<div class="col-md-3">
<label class="form-label">C√≥digo promocional</label>
<input class="form-control" data-save="1" id="imp_codigo" type="text"/>
</div>
<div class="col-12 position-relative">
<label class="form-label">Condiciones</label>
<div class="input-group">
<textarea class="form-control" data-save="1" id="imp_condiciones_es" placeholder="Condiciones (ES)" rows="2"></textarea>
<span class="input-group-text" onclick="mostrarTraduccion(this)" style="cursor:pointer;">üåê</span>
</div>
<div class="traduccion d-none position-absolute bg-white border rounded p-3 shadow" style="z-index:10; right:0; width: min(520px, 92vw);">
<div class="mb-2"><small class="text-muted">Catal√†</small><textarea class="form-control" data-save="1" id="imp_condiciones_ca" placeholder="Condicions (CA)" rows="2"></textarea></div>
<div><small class="text-muted">English</small><textarea class="form-control" data-save="1" id="imp_condiciones_en" placeholder="Terms (EN)" rows="2"></textarea></div>
</div>
</div>
</div>
</section>
<section class="mb-5" id="seccion-inscripcion">
<h2 class="h5 mb-3 border-bottom pb-2">Inscripci√≥n</h2>
<div class="row g-3">
<div class="col-md-3">
<label class="form-label">Inicio inscripci√≥n</label>
<input class="form-control" data-save="1" id="insc_inicio" type="date"/>
</div>
<div class="col-md-3">
<label class="form-label">Fin inscripci√≥n</label>
<input class="form-control" data-save="1" id="insc_fin" type="date"/>
</div>
<div class="col-md-3">
<label class="form-label">N¬∫ de plazas</label>
<input class="form-control" data-save="1" id="insc_plazas" min="0" step="1" type="number" inputmode="numeric"/>
</div>
<div class="col-md-3">
<label class="form-label d-block">Lista de espera</label>
<div class="form-check form-switch">
<input class="form-check-input" data-save="1" id="insc_lista_espera" type="checkbox"/>
<label class="form-check-label" for="insc_lista_espera">Activar</label>
</div>
</div>
<div class="col-md-4">
<label class="form-label">Modalidad</label>
<select class="form-select" data-save="1" id="insc_modalidad">
<option value="">Selecciona</option>
<option>Presencial</option>
<option>Online</option>
<option>Mixta</option>
</select>
</div>
<div class="col-12 position-relative">
<label class="form-label">Requisitos</label>
<div class="input-group">
<textarea class="form-control" data-save="1" id="insc_requisitos_es" placeholder="Requisitos (ES)" rows="2"></textarea>
<span class="input-group-text" onclick="mostrarTraduccion(this)" style="cursor:pointer;">üåê</span>
</div>
<div class="traduccion d-none position-absolute bg-white border rounded p-3 shadow" style="z-index:10; right:0; width: min(520px, 92vw);">
<div class="mb-2"><small class="text-muted">Catal√†</small><textarea class="form-control" data-save="1" id="insc_requisitos_ca" placeholder="Requisits (CA)" rows="2"></textarea></div>
<div><small class="text-muted">English</small><textarea class="form-control" data-save="1" id="insc_requisitos_en" placeholder="Requirements (EN)" rows="2"></textarea></div>
</div>
</div>
</div>
</section>
<section class="mb-5" id="seccion-programa">
<h2 class="h5 mb-3 border-bottom pb-2">Programa</h2>
<div class="row g-3">
<div class="col-12 position-relative">
<label class="form-label">Descripci√≥n</label>
<div class="input-group">
<textarea class="form-control" data-save="1" id="programa_descripcion_es" placeholder="Descripci√≥n (ES)" rows="3"></textarea>
<span class="input-group-text" onclick="mostrarTraduccion(this)" style="cursor:pointer;">üåê</span>
</div>
<div class="traduccion d-none position-absolute bg-white border rounded p-3 shadow" style="z-index:10; right:0; width: min(520px, 92vw);">
<div class="mb-2"><small class="text-muted">Catal√†</small><textarea class="form-control" data-save="1" id="programa_descripcion_ca" placeholder="Descripci√≥ (CA)" rows="2"></textarea></div>
<div><small class="text-muted">English</small><textarea class="form-control" data-save="1" id="programa_descripcion_en" placeholder="Description (EN)" rows="2"></textarea></div>
</div>
</div>
<div class="col-12 position-relative">
<label class="form-label">Contenidos</label>
<div class="input-group">
<textarea class="form-control" data-save="1" id="programa_contenidos_es" placeholder="Contenidos (ES)" rows="3"></textarea>
<span class="input-group-text" onclick="mostrarTraduccion(this)" style="cursor:pointer;">üåê</span>
</div>
<div class="traduccion d-none position-absolute bg-white border rounded p-3 shadow" style="z-index:10; right:0; width: min(520px, 92vw);">
<div class="mb-2"><small class="text-muted">Catal√†</small><textarea class="form-control" data-save="1" id="programa_contenidos_ca" placeholder="Continguts (CA)" rows="2"></textarea></div>
<div><small class="text-muted">English</small><textarea class="form-control" data-save="1" id="programa_contenidos_en" placeholder="Contents (EN)" rows="2"></textarea></div>
</div>
</div>
<div class="col-12 position-relative">
<label class="form-label">Objetivos</label>
<div class="input-group">
<textarea class="form-control" data-save="1" id="programa_objetivos_es" placeholder="Objetivos (ES)" rows="3"></textarea>
<span class="input-group-text" onclick="mostrarTraduccion(this)" style="cursor:pointer;">üåê</span>
</div>
<div class="traduccion d-none position-absolute bg-white border rounded p-3 shadow" style="z-index:10; right:0; width: min(520px, 92vw);">
<div class="mb-2"><small class="text-muted">Catal√†</small><textarea class="form-control" data-save="1" id="programa_objetivos_ca" placeholder="Objectius (CA)" rows="2"></textarea></div>
<div><small class="text-muted">English</small><textarea class="form-control" data-save="1" id="programa_objetivos_en" placeholder="Objectives (EN)" rows="2"></textarea></div>
</div>
</div>
<div class="col-md-4">
<label class="form-label">Duraci√≥n (horas)</label>
<input class="form-control" data-save="1" id="programa_duracion" min="0" step="0.5" type="number"/>
</div>
<div class="col-md-4">
<label class="form-label">Fecha de inicio</label>
<input class="form-control" data-save="1" id="programa_inicio" type="date"/>
</div>
<div class="col-md-4">
<label class="form-label">Fecha de fin</label>
<input class="form-control" data-save="1" id="programa_fin" type="date"/>
</div>
</div>
<div class="row g-3 mt-1">
<div class="col-md-4" data-ug="SAE">
<label class="form-label">Tipus d'estudi (SAE)</label>
<select class="form-select" id="tipusEstudiSAE">
<option value="">Selecciona...</option>
<option>Grau</option><option>M√†ster</option><option>Doctorat</option>
</select>
</div>
<div class="col-md-4" data-ug="SAE">
<label class="form-label">Categoria (SAE)</label>
<select class="form-select" id="categoriaSAE">
<option value="">Selecciona...</option>
<option>B√†sic</option><option>Avan√ßat</option><option>Especialitzaci√≥</option>
</select>
</div>
<div class="col-md-4" data-ug="SAE">
<label class="form-label">Compet√®ncies (SAE)</label>
<input class="form-control" id="competenciesSAE" placeholder="Especifica compet√®ncies"/>
</div>
</div>
</section>
<div class="bg-white rounded shadow p-4">
<section class="mb-5">
<h2 class="h5 mb-3 border-bottom pb-2">Subactividades</h2>
<div class="mb-3" id="subactividadesContainer"></div>
<button class="btn btn-outline-primary" onclick="addSubactividad()" type="button">A√±adir Subactividad</button>
</section>
<section class="mb-5">
<h2 class="h5 mb-3 border-bottom pb-2">Participantes</h2>
<div class="mb-3" id="participantesContainer"></div>
<button class="btn btn-outline-primary" onclick="addParticipante()" type="button">A√±adir Participante</button>
</section>
</div>
<div class="d-flex gap-2 mt-4">
<button class="btn btn-primary" id="btnGuardarActividad" type="button">Guardar Actividad</button>
</div></main>
</div>
</div>
<!-- Cargamos el men√∫ lateral desde un √∫nico recurso JS para reutilizar en todas las p√°ginas -->
<script src="menu.js"></script>
<script>
  document.addEventListener('DOMContentLoaded', function () {
    loadSidebarMenu('sidebarContainer');
  });
</script>
<script>
  // Feedback de validaci√≥n bajo campos
  (function(){
    function ensureFeedback(el){
      var fb = el.nextElementSibling;
      if(!fb || !fb.classList || !fb.classList.contains('invalid-feedback')){
        fb = document.createElement('div');
        fb.className = 'invalid-feedback';
        el.parentNode.insertBefore(fb, el.nextSibling);
      }
      return fb;
    }
    function updateFeedback(el){
      var fb = ensureFeedback(el);
      if(el.checkValidity()){
        fb.textContent = '';
        fb.classList.remove('d-block');
      } else {
        var msg = el.validationMessage || el.getAttribute('title') || 'Valor no v√°lido';
        fb.textContent = msg;
        fb.classList.add('d-block');
      }
    }
    function attach(){
      var fields = document.querySelectorAll('input, select, textarea');
      fields.forEach(function(el){
        // Crear placeholder de feedback si procede
        ensureFeedback(el);
        ['blur','input','change'].forEach(function(evt){
          el.addEventListener(evt, function(){ updateFeedback(el); });
        });
      });
    }
    document.addEventListener('DOMContentLoaded', attach);
  })();
  </script>
<!-- Cabecera unificada -->
<script src="header.js"></script>
<script>
  document.addEventListener('DOMContentLoaded', function () {
    loadHeader('headerContainer');
  });
</script>
<script>
function mostrarTraduccion(elemento) {
  const div = elemento.closest('.position-relative').querySelector('.traduccion');
  div.classList.toggle('d-none');
}

function toggleImporte() {
  const pago = document.getElementById("actividadPago").checked;
  document.getElementById("importeCampos").classList.toggle("d-none", !pago);
}
</script>
<!-- El men√∫ de usuario y el selector de UG ser√°n proporcionados por header.js -->

<script>
(function(){
  const subCont = document.getElementById('subactividadesContainer');
  let subactividadCounter = 0;
  function subCard(){
    const div = document.createElement('div');
    div.className = 'card mb-2 shadow-sm';
    const subactividadId = `subactividad_${++subactividadCounter}`;
    div.innerHTML = `
      <div class="card-body">
        <div class="d-flex justify-content-between align-items-start mb-2">
          <h6 class="mb-0">Subactividad</h6>
          <div class="btn-group btn-group-sm">
            <button type="button" class="btn btn-outline-secondary" data-dup>Duplicar</button>
            <button type="button" class="btn btn-outline-danger" data-del>Eliminar</button>
          </div>
        </div>
        <div class="row g-3">
          <div class="col-md-4"><label class="form-label">T√≠tulo</label><input class="form-control" id="${subactividadId}_titulo" /></div>
          <div class="col-md-4"><label class="form-label">Modalidad</label><select class="form-select" id="${subactividadId}_modalidad"><option>Presencial</option><option>Online</option><option>Mixta</option></select></div>
          <div class="col-md-4"><label class="form-label">Docente/s</label><input class="form-control" id="${subactividadId}_docente" /></div>
          <div class="col-md-3"><label class="form-label">Fecha inicio</label><input type="date" class="form-control" id="${subactividadId}_fechaInicio" /></div>
          <div class="col-md-3"><label class="form-label">Fecha fin</label><input type="date" class="form-control" id="${subactividadId}_fechaFin" /></div>
          <div class="col-md-3"><label class="form-label">Hora inicio</label><input type="time" class="form-control" id="${subactividadId}_horaInicio" /></div>
          <div class="col-md-3"><label class="form-label">Hora fin</label><input type="time" class="form-control" id="${subactividadId}_horaFin" /></div>
          <div class="col-md-3"><label class="form-label">Duraci√≥n (h)</label><input type="number" step="0.5" class="form-control" id="${subactividadId}_duracion" /></div>
          <div class="col-md-3"><label class="form-label">Ubicaci√≥n / Aula</label><input class="form-control" id="${subactividadId}_ubicacion" /></div>
          <div class="col-md-3"><label class="form-label">Aforo</label><input type="number" min="0" class="form-control" id="${subactividadId}_aforo" /></div>
          <div class="col-md-3"><label class="form-label">Idioma</label><input class="form-control" id="${subactividadId}_idioma" /></div>
          <div class="col-12"><label class="form-label">Descripci√≥n</label><textarea class="form-control" rows="2" id="${subactividadId}_descripcion"></textarea></div>
        </div>
      </div>`;
    div.querySelector('[data-del]').addEventListener('click', ()=> div.remove());
    div.querySelector('[data-dup]').addEventListener('click', ()=> subCont && subCont.appendChild(subCard()));
    return div;
  }
  window.addSubactividad = function(){ subCont && subCont.appendChild(subCard()); };

  const partCont = document.getElementById('participantesContainer');
  let participanteCounter = 0;
  function partRow(){
    const wrap = document.createElement('div');
    wrap.className = 'row g-2 align-items-end mb-2';
    const participanteId = `participante_${++participanteCounter}`;
    wrap.innerHTML = `
      <div class="col-md-4"><label class="form-label">Nombre</label><input class="form-control" id="${participanteId}_nombre" /></div>
      <div class="col-md-3"><label class="form-label">Rol</label><select class="form-select" id="${participanteId}_rol"><option>Ponente</option><option>Coordinaci√≥n</option><option>Invitado</option></select></div>
      <div class="col-md-3"><label class="form-label">Email</label><input type="email" class="form-control" id="${participanteId}_email" /></div>
      <div class="col-md-2 d-flex gap-2"><button type="button" class="btn btn-outline-secondary btn-sm flex-grow-1" data-dup>Duplicar</button><button type="button" class="btn btn-outline-danger btn-sm flex-grow-1" data-del>Eliminar</button></div>`;
    wrap.querySelector('[data-del]').addEventListener('click', ()=> wrap.remove());
    wrap.querySelector('[data-dup]').addEventListener('click', ()=> partCont && partCont.appendChild(partRow()));
    return wrap;
  }
  window.addParticipante = function(){ partCont && partCont.appendChild(partRow()); };
  if (subCont && !subCont.children.length) window.addSubactividad();
  if (partCont && !partCont.children.length) window.addParticipante();
})();

// Script eliminado - se maneja desde scripts-clean.js
</script>
<script>
  // Poner fecha de hoy en el calendario
  document.addEventListener('DOMContentLoaded', function () {
    try {
      const hoy = new Date();
      const cal = document.getElementById('fechaCreacion');
      if (cal) {
        cal.textContent = hoy.toLocaleDateString('es-ES', { day: '2-digit', month: 'short', year: 'numeric' });
      }
    } catch {}
  });
</script>
    <!-- Script de autenticaci√≥n -->
    <script src="auth.js"></script>
    <script src="scripts-clean.js"></script>
    <!-- Script para campos espec√≠ficos por unidad gestora -->
    <script src="ug-specific-fields.js"></script>
    <script>
        // Actualizar el nombre del responsable de la propuesta
        function updateResponsablePropuesta() {
            try {
                const responsableSpan = document.getElementById('responsablePropuesta');
                if (!responsableSpan) {
                    console.warn('‚ö†Ô∏è Elemento responsablePropuesta no encontrado');
                    return;
                }

                // Verificar si Auth est√° disponible
                if (typeof Auth === 'undefined') {
                    responsableSpan.textContent = 'Auth no disponible';
                    console.warn('‚ö†Ô∏è Auth no est√° disponible');
                    return;
                }

                // Obtener informaci√≥n del usuario
                const token = Auth.getToken();
                const user = Auth.getUser();

                console.log('üîç DEBUG: Token:', token ? 'Presente' : 'Ausente');
                console.log('üîç DEBUG: Usuario:', user);

                if (token && user?.username) {
                    responsableSpan.textContent = user.username;
                    console.log('‚úÖ Responsable de propuesta actualizado:', user.username);
                } else if (token) {
                    responsableSpan.textContent = 'Usuario';
                    console.log('‚ö†Ô∏è Token presente pero sin nombre de usuario');
                } else {
                    responsableSpan.textContent = 'No conectado';
                    console.log('‚ö†Ô∏è Sin token de autenticaci√≥n');
                }
            } catch (error) {
                console.error('Error actualizando responsable de propuesta:', error);
                const responsableSpan = document.getElementById('responsablePropuesta');
                if (responsableSpan) responsableSpan.textContent = 'Error';
            }
        }

        // Actualizar cuando el DOM est√© listo
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ DOMContentLoaded - Iniciando actualizaci√≥n de responsable...');
            
            // Actualizar inmediatamente
            updateResponsablePropuesta();
            
            // Tambi√©n actualizar despu√©s de delays para asegurar que Auth est√© disponible
            setTimeout(updateResponsablePropuesta, 500);
            setTimeout(updateResponsablePropuesta, 1500);
            setTimeout(updateResponsablePropuesta, 3000);
        });

        // Script para cargar dominios despu√©s de que todo est√© listo
        window.addEventListener('load', function() {
            console.log('üöÄ Window load - Iniciando carga de dominios...');
            
            // Esperar un poco m√°s para asegurar que todos los scripts est√©n cargados
            setTimeout(function() {
                if (typeof cargarDominios === 'function') {
                    console.log('‚úÖ Funci√≥n cargarDominios encontrada, ejecutando...');
                    cargarDominios();
                } else {
                    console.error('‚ùå Funci√≥n cargarDominios no encontrada');
                }
                
                // Inicializar campos espec√≠ficos por unidad gestora
                setTimeout(function() {
                    if (typeof window.initializeUGSpecificFields === 'function') {
                        console.log('‚úÖ Inicializando campos espec√≠ficos por UG...');
                        window.initializeUGSpecificFields();
                    } else {
                        console.warn('‚ö†Ô∏è Funci√≥n initializeUGSpecificFields no encontrada');
                    }
                }, 1000);
                
            }, 2000);
        });
    </script>
</body>
</html>
